<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SART - Sistema de Soporte y Reporte Tecnológico UNEFA</title>
    <style>
        /* --- VARIABLES --- */
        :root {
            --color-primary: #003366;
            --color-primary-dark: #002244;
            --color-secondary: #D4AF37;
            --color-danger: #ce1126;
            --color-success: #10B981;
            --color-warning: #f59e0b;
            --color-dark: #1f2937;
            --color-bg: #f3f4f6;
            --color-white: #ffffff;
            --color-text: #374151;
            --color-text-light: #9CA3AF;
            --border-color: #e5e7eb;

            --sidebar-width: 260px;
            --header-height: 60px;
            --radius: 6px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background-color: var(--color-bg); color: var(--color-text); height: 100vh; overflow: hidden; }

        .hidden { display: none !important; }
        .text-primary { color: var(--color-primary); }
        .text-secondary { color: var(--color-text-light); }
        .text-danger { color: var(--color-danger); }
        .text-success { color: var(--color-success); }
        .text-sm { font-size: 0.85rem; }
        .font-bold { font-weight: bold; }
        .uppercase { text-transform: uppercase; }
        .block { display: block; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 1rem; }
        .w-full { width: 100%; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .p-2 { padding: 0.5rem; }
        .border { border: 1px solid var(--border-color); }
        .rounded { border-radius: var(--radius); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .overflow-y-auto { overflow-y: auto; }

        .filter-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 0.8rem; align-items: end;
            background-color: #f8fafc; padding: 1rem; border-radius: var(--radius); border: 1px solid var(--border-color); margin-bottom: 1rem;
        }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        button { cursor: pointer; border: none; border-radius: var(--radius); font-weight: 600; padding: 0.6rem 1.2rem; transition: background 0.2s; font-size: 0.9rem; }
        .btn-primary { background-color: var(--color-primary); color: white; } .btn-primary:hover { background-color: var(--color-primary-dark); }
        .btn-secondary { background-color: #e5e7eb; color: var(--color-text); } .btn-secondary:hover { background-color: #d1d5db; }
        .btn-success { background-color: var(--color-success); color: white; } .btn-warning { background-color: var(--color-warning); color: white; }
        .btn-danger { background-color: var(--color-danger); color: white; }

        .btn-logout {
            width: 100%; padding: 0.75rem 1rem; border: 1px solid rgba(255,255,255,0.2); background-color: transparent; color: rgba(255,255,255,0.7); display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s;
        }
        .btn-logout:hover { background-color: rgba(0,0,0,0.2); color: var(--color-white); border-color: rgba(255,255,255,0.4); }

        .header-actions { display: flex; gap: 0.5rem; align-items: center; }
        .btn-report-red { background-color: var(--color-danger); color: white; padding: 0.4rem 0.8rem; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; border-radius: 4px; }
        .btn-report-red:hover { background-color: #b91c1c; }
        .btn-report-dark { background-color: var(--color-dark); color: white; padding: 0.4rem 0.8rem; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; border-radius: 4px; }
        .btn-report-dark:hover { background-color: #000; }
        .btn-clean { background: var(--color-white); border: 1px solid var(--border-color); color: var(--color-text); padding: 0.4rem 0.8rem; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.85rem; }
        .btn-clean:hover { background-color: #f3f4f6; color: var(--color-danger); border-color: var(--color-danger); }

        .btn-sm { padding: 0.3rem 0.6rem; }
        .btn-icon { background: transparent; color: inherit; padding: 0.5rem; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        .btn-icon:hover { background-color: rgba(0,0,0,0.05); border-radius: 50%; }
        .btn-delete { color: var(--color-danger); background: none; font-size: 1.2rem; line-height: 1; padding: 0 0.5rem; }
        .action-group { display: flex; gap: 0.25rem; justify-content: center; }

        input, select, textarea { width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius); outline: none; font-size: 0.85rem; background: var(--color-white); }
        input:focus, select:focus, textarea:focus { border-color: var(--color-primary); box-shadow: 0 0 0 2px rgba(0, 51, 102, 0.1); }
        textarea { resize: vertical; min-height: 80px; max-height: 200px; }
        .char-counter { font-size: 0.7rem; color: var(--color-text-light); text-align: right; margin-top: 2px; }
        .filter-label { font-size: 0.7rem; font-weight: bold; color: var(--color-text-light); margin-bottom: 0.3rem; display: block; text-transform: uppercase; }
        .truncate-text { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .card { background: var(--color-white); border-radius: var(--radius); box-shadow: var(--shadow); padding: 1.5rem; margin-bottom: 1.5rem; height: 100%; display: flex; flex-direction: column; }
        .card-header { border-bottom: 1px solid var(--border-color); padding-bottom: 0.8rem; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .card-header-title { color: var(--color-primary); font-weight: bold; font-size: 1.1rem; }
        .card-body-scroll { flex: 1; overflow-y: auto; }

        .login-wrapper { position: fixed; inset: 0; background-color: var(--color-primary); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-box { background: var(--color-white); padding: 2.5rem; border-radius: 12px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2); }
        .login-logo { width: 80px; height: 80px; background: var(--color-white); border: 4px solid var(--color-secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: var(--color-primary); }
        .login-title { color: var(--color-primary); font-size: 1.5rem; margin-bottom: 0.5rem; font-weight: bold; }
        .login-subtitle { color: var(--color-text-light); font-size: 0.9rem; margin-bottom: 1.5rem; }
        .form-label { display: block; font-size: 0.8rem; font-weight: bold; color: var(--color-primary); margin-bottom: 0.25rem; text-transform: uppercase; text-align: left; }
        .login-error-msg { color: var(--color-danger); font-size: 0.85rem; margin-top: 1rem; }

        .app-layout { display: flex; height: 100%; }
        .sidebar { width: var(--sidebar-width); background-color: var(--color-primary); color: var(--color-white); display: flex; flex-direction: column; transition: transform 0.3s; z-index: 50; }
        .sidebar-header { height: var(--header-height); display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; background-color: rgba(0,0,0,0.2); font-weight: bold; letter-spacing: 1px; }
        .sidebar-menu { list-style: none; padding-top: 1rem; flex: 1; }
        .nav-link { padding: 0.8rem 1.5rem; display: flex; align-items: center; gap: 10px; cursor: pointer; transition: background 0.2s; font-size: 0.9rem; color: rgba(255,255,255,0.7); text-decoration: none; }
        .nav-link:hover, .nav-link.active { background-color: rgba(212, 175, 55, 0.15); color: var(--color-secondary); border-left: 4px solid var(--color-secondary); }
        .sidebar-footer { padding: 1rem; background-color: rgba(0,0,0,0.2); }

        .main-content { flex: 1; display: flex; flex-direction: column; background-color: var(--color-bg); overflow: hidden; position: relative; }
        .top-header { height: var(--header-height); background: var(--color-white); display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .header-title { color: var(--color-primary); font-size: 1.25rem; font-weight: bold; }
        .header-user { text-align: right; }
        .header-role { display: block; color: var(--color-primary); font-size: 0.9rem; font-weight: bold; }
        .header-date { font-size: 0.75rem; color: var(--color-text-light); }
        .content-area { flex: 1; overflow-y: auto; padding: 1.5rem; }

        .table-responsive { width: 100%; overflow-x: auto; border: 1px solid var(--border-color); border-radius: var(--radius); }
        .table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .table thead { background-color: #f9fafb; color: var(--color-text-light); text-transform: uppercase; font-size: 0.75rem; }
        .table th, .table td { padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); text-align: left; }
        .table-empty { padding: 2rem; text-align: center; color: var(--color-text-light); }
        
        .badge { padding: 0.25rem 0.5rem; border-radius: 99px; font-size: 0.75rem; font-weight: bold; }
        .badge.pending { background-color: #FEF3C7; color: #D97706; }
        .badge.repaired { background-color: #D1FAE5; color: #059669; }
        .badge.norepaired { background-color: #FEE2E2; color: #DC2626; }

        /* BADGES DISPOSITIVOS */
        .dev-badge { padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        .dev-pc { background: #e0f2fe; color: #0369a1; }
        .dev-laptop { background: #f0fdf4; color: #15803d; }
        .dev-printer { background: #fef3c7; color: #b45309; }
        .dev-network { background: #f3e8ff; color: #7e22ce; }
        .dev-other { background: #f3f4f6; color: #4b5563; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .stat-card { border-top: 4px solid transparent; height: auto; }
        .stat-card.gold { border-color: var(--color-secondary); }
        .stat-card.green { border-color: var(--color-success); }
        .stat-card.blue { border-color: var(--color-primary); }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; color: var(--color-text-light); display: block; }
        .stat-value { font-size: 2rem; font-weight: bold; color: var(--color-text); margin-top: 0.5rem; }

        .pagination-container { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; }
        .page-info { font-size: 0.9rem; color: var(--color-text-light); }
        .page-btn { padding: 0.4rem 0.8rem; border: 1px solid var(--border-color); background: white; border-radius: var(--radius); cursor: pointer; }
        .page-btn:hover:not(:disabled) { background-color: #f3f4f6; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .modal-container { background: var(--color-white); width: 100%; max-width: 600px; border-radius: var(--radius); overflow: hidden; animation: fadeIn 0.2s; display: flex; flex-direction: column; max-height: 90vh; }
        .modal-header { background: var(--color-primary); color: var(--color-white); padding: 1rem; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .modal-body { padding: 1.5rem; overflow-y: auto; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
        .ticket-info-box { background: #f0f7ff; padding: 0.75rem; border-radius: 4px; margin-bottom: 1rem; }
        
        .special-select-input { max-height: 100px; }
        .special-select-input.hidden { display: none; }
        .special-select-select.hidden { display: none; }
        
        /* Estilos específicos para la vista de detalles */
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .detail-item { margin-bottom: 0.5rem; }
        .detail-label { font-weight: bold; color: var(--color-primary); font-size: 0.8rem; display: block; }
        .detail-value { font-size: 0.95rem; }
    
        .card.period { grid-column: span 1; padding: 1rem; background-image: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark)); color: var(--color-white); border-top: none !important; }
        @media (min-width: 1024px) { .card.period { grid-column: span 2; } }
        .card.period .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .card.period .header h2 { font-size: 1.1rem; font-weight: bold; color: white; }
        .card.period .content { display: grid; grid-template-columns: auto 1fr; gap: 1rem; align-items: center; }
        .card.period .content h2[data-render="current-period"] { font-size: 1.8rem; font-weight: 800; line-height: 1; }
        .card.period .progress-and-dates { display: flex; flex-direction: column; justify-content: center; gap: 0.2rem; width: 100%; }
        .card.period .dates { display: flex; justify-content: space-between; font-size: 0.8rem; opacity: 0.9; }
        .card.period .progress-bar-wrapper { position: relative; border-radius: 9999px; overflow: hidden; width: 100%; height: 1.2rem; background: rgba(255,255,255,0.2); }
        .card.period .progress-bar { height: 100%; border-radius: 9999px; background: var(--color-secondary); width: 0%; transition: width 1s ease-in-out; }
        .card.period .progress-bar-wrapper p { 
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; 
            font-weight: 700; font-size: 0.75rem; 
            color: white; 
            mix-blend-mode: difference; /* FIX: Color del porcentaje visible siempre */
            z-index: 10;
        }
        
        .sidebar-toggle-btn { display: none; } 
        .sidebar-close-btn { display: none; }
        @media (max-width: 768px) {
            .sidebar { position: absolute; height: 100%; transform: translateX(-100%); }
            .sidebar.is-open { transform: translateX(0); }
            .sidebar-toggle-btn { display: block; margin-right: 1rem; }
            .sidebar-close-btn { display: block; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; } 
            .header-user { display: none; }
            .action-group { flex-direction: column; }
            .filter-grid { grid-template-columns: 1fr; }
            .header-actions { flex-wrap: wrap; justify-content: flex-end; }
        }
    </style>
</head>
<body>
	<!-- Falta -->
    
    <script>
        document.addEventListener('DOMContentLoaded', () => { app.init(); });
        
        const app = {
			// Falta
			
			
			// NO TOCAR EL HTML/CSS GENERADO AQUÍ, SOLO LO EMBEBIDO
            printReport(mode) {
                const data = mode === 'view' ? this.state.filteredTickets : [...this.state.tickets].sort((a,b) => b.id - a.id);
                if (!data || data.length === 0) { alert("No hay datos para generar el reporte."); return; }
                const URL_LOGO_IZQUIERDO = '/static/public/logo-fuerzas-armadas.avif'; 
                const URL_LOGO_DERECHO = '/static/public/logo-unefa.avif';
                let reportContent = '';
                const ROWS_PER_PAGE = 12;
                const totalPages = Math.ceil(data.length / ROWS_PER_PAGE);
                for (let i = 0; i < totalPages; i++) {
                    const pageData = data.slice(i * ROWS_PER_PAGE, (i + 1) * ROWS_PER_PAGE);
                    const headerHTML = `<div class="header-container"><div class="logo-box"><img src="${URL_LOGO_IZQUIERDO}" alt="Logo Izq"></div><div class="header-text">MINISTERIO DEL PODER POPULAR PARA LA DEFENSA<br>UNIVERSIDAD NACIONAL EXPERIMENTAL POLITÉCNICA DE LA FUERZA ARMADA<br>NÚCLEO MIRANDA - SEDE LOS TEQUES<br>COORDINACIÓN DE TECNOLOGÍA Y SOPORTE<br>TECNOLOGÍA, INFORMACIÓN Y COMUNICACIÓN<br>SOPORTE TÉCNICO</div><div class="logo-box"><img src="${URL_LOGO_DERECHO}" alt="Logo Der"></div></div><div class="section-title">REPORTE DE GESTIÓN DE SOPORTE TÉCNICO</div>`;
                    let rowsHTML = '';
                    pageData.forEach((t, idx) => { const num = (i * ROWS_PER_PAGE) + idx + 1; rowsHTML += `<tr><td class="col-center">${num}</td><td class="col-center">${this.fmtDate(t.dateIn || t.date_in)}</td><td class="col-center"><b>${t.code}</b><br>${t.device_type || t.type}</td><td class="col-center">${t.location}</td><td class="col-center">${t.dateOut || t.date_out ? this.fmtDate(t.dateOut || t.date_out) : '-'}</td><td class="col-left" style="font-size:8pt;">${t.detailsOut || t.detailsIn || t.details_in || t.issue || '-'}</td><td class="col-center" style="font-size:8pt;">${t.status}</td></tr>`; });
                    let signaturesHTML = '';
                    if (i === totalPages - 1) { signaturesHTML = `<div class="signatures"><div class="sign-box"><div style="margin-top:5px; margin-bottom:2px; font-weight:normal;">${adminName}</div>${adminJob}<br><span style="font-weight:normal;font-size:8pt;">FIRMA Y SELLO</span></div><div class="sign-box"><div style="margin-top:5px; margin-bottom:2px; font-weight:normal;">${coordName}</div>${coordJob}<br><span style="font-weight:normal;font-size:8pt;">FIRMA Y SELLO</span></div></div>`; }
                    reportContent += `<div class="page">${headerHTML}<table><thead><tr><th style="width:5%">N°</th><th style="width:10%">FECHA</th><th style="width:15%">EQUIPO</th><th style="width:15%">UBICACIÓN</th><th style="width:10%">SALIDA</th><th style="width:35%">DETALLE / SOLUCIÓN</th><th style="width:10%">ESTADO</th></tr></thead><tbody>${rowsHTML}</tbody></table>${signaturesHTML}<div class="footer-info"><span>Sistema S.A.R.T.</span><span>Página ${i + 1} de ${totalPages}</span></div></div>`;
                }
                const iframe = document.createElement('iframe'); iframe.style.position = 'absolute'; iframe.style.width = '0px'; iframe.style.height = '0px'; iframe.style.border = 'none'; document.body.appendChild(iframe);
                const doc = iframe.contentWindow.document; doc.open(); doc.write(`<!DOCTYPE html><html><head><title>Reporte SART</title><style>@page { size: letter; margin: 0; } body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #ccc; } .page { width: 215.9mm; height: 279.4mm; background: white; margin: 0 auto; padding: 15mm; position: relative; page-break-after: always; overflow: hidden; } .header-container { display: flex; justify-content: space-between; align-items: center; height: 110px; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; overflow: hidden; } .logo-box { width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; } .logo-box img { width: 100%; height: 100%; object-fit: contain; } .header-text { flex: 1; text-align: center; font-weight: bold; font-size: 8pt; line-height: 1.2; padding: 0 10px; } .section-title { font-weight: bold; margin-bottom: 10px; font-size: 11pt; text-align: center; text-decoration: underline; } table { width: 100%; border-collapse: collapse; font-size: 9pt; } th, td { border: 1px solid black; padding: 4px; vertical-align: middle; } th { background: #f0f0f0; text-align: center; font-weight: bold; } .col-center { text-align: center; } .col-left { text-align: left; } .signatures { margin-top: 50px; display: flex; justify-content: space-around; } .sign-box { width: 40%; text-align: center; border-top: 1px solid black; padding-top: 5px; font-weight: bold; font-size: 9pt; } .footer-info { position: absolute; bottom: 15mm; left: 15mm; right: 15mm; display: flex; justify-content: space-between; font-size: 8pt; border-top: 1px solid #ccc; padding-top: 5px; } </style></head><body>${reportContent}</body></html>`); doc.close();
                iframe.contentWindow.focus(); setTimeout(() => { iframe.contentWindow.print(); document.body.removeChild(iframe); }, 500);
            }
        };
    </script>
</body>
</html>